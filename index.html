<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LJ Lounge â€“ GetrÃ¤nke- & Shishakarte</title>
  <meta name="theme-color" content="#0b0b0b" />
  <style>
    :root{
      --bg:#0b0b0b; --card:#141414; --line:#262626; --txt:#ffffff;
      --muted:#b6b6b6; --accent:#c9a24d; --chip:#1c1c1c;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        linear-gradient(rgba(0,0,0,0.68), rgba(0,0,0,0.78)),
        url("images/background.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }
    a{color:inherit}
    .wrap{max-width:980px;margin:0 auto;padding:14px}

    header{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(180deg, rgba(11,11,11,.98), rgba(11,11,11,.92));
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }

    .top{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; padding:14px; flex-wrap:wrap;
    }
    .logo-wrap{display:flex;align-items:center;gap:10px;min-width:220px}
    .logo{height:42px;width:auto;flex:0 0 auto}
    .brand{display:flex;flex-direction:column}
    .brand h1{margin:0;font-size:18px;letter-spacing:.4px}
    .brand .sub{margin-top:2px;color:var(--muted);font-size:12px}
    .right-wrap{display:flex;align-items:center;gap:10px;margin-left:auto}

    .socials{display:flex;align-items:center;gap:10px}
    .socials a{
      display:inline-flex;align-items:center;justify-content:center;
      width:36px;height:36px;border-radius:999px;
      border:1px solid var(--line);background:rgba(20,20,20,.7);
      transition:all .2s ease;
      color:var(--txt);
    }
    .socials a:hover{border-color:rgba(201,162,77,.8);transform:translateY(-1px)}
    .socials svg{width:18px;height:18px;display:block}
    .socials svg path{fill:currentColor}

    /* Warenkorb Button */
    .cartBtn{
      display:inline-flex; align-items:center; gap:8px;
      height:36px; padding:0 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(20,20,20,.7);
      cursor:pointer;
      color:var(--txt);
      transition:all .2s ease;
    }
    .cartBtn:hover{border-color:rgba(201,162,77,.8);transform:translateY(-1px)}
    .cartCount{
      min-width:20px;height:20px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      font-size:12px;font-weight:900;
      background:rgba(201,162,77,.18);
      border:1px solid rgba(201,162,77,.35);
      color:var(--accent);
    }

    .controls{display:flex;gap:10px;padding:0 14px 14px}
    .search{
      flex:1; display:flex; align-items:center; gap:10px;
      background:rgba(20,20,20,.88);
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      backdrop-filter: blur(4px);
    }
    .search input{
      width:100%; background:transparent; border:0; outline:0;
      color:var(--txt); font-size:14px;
    }

    .tabs{display:flex;gap:8px;overflow:auto;padding:0 14px 14px}
    .tab{
      border:1px solid var(--line);
      background:rgba(28,28,28,.88);
      color:var(--muted);
      padding:9px 12px;border-radius:999px;font-size:13px;cursor:pointer;white-space:nowrap;
      user-select:none;
      backdrop-filter: blur(4px);
    }
    .tab.active{
      border-color:rgba(201,162,77,.6);
      color:var(--txt);
      box-shadow:0 0 0 1px rgba(201,162,77,.15) inset
    }

    main{padding:14px}
    .section-title{margin:10px 0 10px;color:var(--accent);font-size:13px;letter-spacing:.6px;text-transform:uppercase}

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(210px,1fr));
      gap:12px;
    }

    /* Produktkarten */
    .card{
      background: rgba(20,20,20,0.88);
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 240px;
      backdrop-filter: blur(4px);
    }
    .img{
      width:100%;
      height:auto; /* komplettes GetrÃ¤nk anzeigen */
      display:block;
    }
    .pad{padding:12px}
    .row{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .name{font-weight:800;font-size:14px}
    .price{color:var(--accent);font-weight:900;white-space:nowrap}
    .desc{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.35}
    .actions{margin-top:auto;padding:12px;border-top:1px solid var(--line);display:flex;gap:10px}
    .btn{
      width:100%;
      border:1px solid var(--line);
      background:#171717;
      color:var(--txt);
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      font-size:13px;
      cursor:pointer;
    }
    .btn.secondary{background:transparent;color:var(--muted);cursor:default}
    .btn:hover{border-color:rgba(201,162,77,.55)}

    /* Add/Minus Buttons */
    .btnRow{display:flex; gap:10px; width:100%}
    .btn.icon{
      width:44px; min-width:44px;
      display:inline-flex; align-items:center; justify-content:center;
      font-size:18px; font-weight:900;
    }

    /* Start-Kacheln */
    .tile{
      position:relative;
      height:140px;
      border-radius:var(--radius);
      overflow:hidden;
      border:1px solid var(--line);
      cursor:pointer;
      backdrop-filter: blur(4px);
      background:#0f0f0f;
      transition:transform .15s ease, border-color .15s ease;
    }
    .tile:hover{
      transform:translateY(-2px);
      border-color:rgba(201,162,77,.6);
    }
    .tile img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter:saturate(1.05) contrast(1.05);
      transform:scale(1.02);
    }
    .tile::after{
      content:"";
      position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.75));
    }
    .tileText{
      position:absolute;
      left:12px; right:12px; bottom:12px;
      z-index:2;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .tileTitle{font-weight:950;letter-spacing:.3px}
    .tileSub{color:rgba(255,255,255,.78);font-size:12px}

    footer{padding:18px 14px 26px;color:var(--muted);font-size:12px}
    .hint{
      border-top:1px solid var(--line);
      padding-top:14px;
      margin-top:18px;
      line-height:1.5;
    }

    /* Modal */
    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,.65);
      display:none; align-items:flex-end; justify-content:center; z-index:50;
    }
    .modal.open{display:flex}
    .sheet{
      width:min(980px,100%);
      background:#101010;
      border:1px solid var(--line);
      border-bottom:0;
      border-radius:18px 18px 0 0;
      padding:14px;
      max-height:80vh;
      overflow:auto;
    }
    .sheetTop{display:flex;justify-content:space-between;align-items:flex-start;gap:10px}
    .sheet h3{margin:0;font-size:16px}
    .sheet p{margin:6px 0 0;color:var(--muted);font-size:12px}
    .close{
      border:1px solid var(--line);
      background:#171717;
      color:var(--txt);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
    }
    .list{margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
    .li{
      border:1px solid var(--line);
      background:#141414;
      border-radius:12px;
      padding:10px;
      font-size:13px;
      color:var(--txt);
    }

    /* Warenkorb-Liste */
    .cartLine{
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
      border:1px solid var(--line);
      background:#141414;
      border-radius:12px;
      padding:10px;
    }
    .cartLeft{display:flex; flex-direction:column; gap:4px}
    .cartName{font-weight:800}
    .cartMeta{color:var(--muted); font-size:12px}
    .cartRight{display:flex; flex-direction:column; align-items:flex-end; gap:6px}
    .qtyRow{display:flex; gap:8px; align-items:center}
    .qtyBtn{
      width:34px;height:34px;border-radius:10px;
      border:1px solid var(--line); background:#171717;
      color:var(--txt); cursor:pointer; font-weight:900;
    }
    .totalRow{
      display:flex; justify-content:space-between; gap:10px;
      margin-top:12px; padding-top:12px; border-top:1px solid var(--line);
      font-weight:900;
    }
    .cartActions{
      display:flex; gap:10px; margin-top:12px;
    }
    .cartActions .btn{flex:1}

    @media (max-width:520px){
      .logo{height:34px}
      .brand h1{font-size:16px}
      .right-wrap{margin-left:0}
      .tile{height:130px}
    }
    @media (max-width:420px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>

<body>

<header>
  <div class="wrap">
    <div class="top">
      <div class="logo-wrap">
        <img src="images/logo.jpg" alt="LJ Lounge Logo" class="logo">
        <div class="brand">
          <h1>LJ Lounge</h1>
          <div class="sub">GetrÃ¤nke- & Shishakarte</div>
        </div>
      </div>

      <div class="right-wrap">
        <div class="socials">
          <a href="https://www.instagram.com/_lj_lounge_?igsh=b2EzMTdiaWZnMGp6" target="_blank" rel="noopener" aria-label="Instagram">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2C4.2 2 2 4.2 2 7v10c0 2.8 2.2 5 5 5h10c2.8 0 5-2.2 5-5V7c0-2.8-2.2-5-5-5H7zm10 2c1.7 0 3 1.3 3 3v10c0 1.7-1.3 3-3 3H7c-1.7 0-3-1.3-3-3V7c0-1.7 1.3-3 3-3h10zm-5 3.5A4.5 4.5 0 1 0 16.5 12 4.5 4.5 0 0 0 12 7.5zm0 7.3A2.8 2.8 0 1 1 14.8 12 2.8 2.8 0 0 1 12 14.8zM17.2 6.8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/></svg>
          </a>
          <a href="https://www.tiktok.com/@_lj_lounge_?_r=1&_t=ZN-93ShOAjJ0ly" target="_blank" rel="noopener" aria-label="TikTok">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21 8.1c-1.5 0-3-.5-4.2-1.4v8.4a6.6 6.6 0 1 1-6.6-6.6c.4 0 .8 0 1.2.1v3.6a2.9 2.9 0 1 0 2 2.7V2h3.4c.3 1.9 2 3.5 4.1 3.7v2.4z"/></svg>
          </a>
        </div>

        <button class="cartBtn" id="cartBtn" type="button" aria-label="Warenkorb Ã¶ffnen">
          ðŸ›’ <span class="cartCount" id="cartCount">0</span>
        </button>
      </div>
    </div>

    <div class="controls" id="controls">
      <div class="search">
        <span aria-hidden="true">ðŸ”Ž</span>
        <input id="q" type="search" placeholder="Suchenâ€¦ (z.B. Mojito, Cola, Gin)" />
      </div>
    </div>

    <div class="tabs" id="tabs">
      <div class="tab active" data-cat="home">Start</div>
      <div class="tab" data-cat="soft">Softdrinks</div>
      <div class="tab" data-cat="hot">Heiss</div>
      <div class="tab" data-cat="cocktail">Cocktails</div>
      <div class="tab" data-cat="longdrink">Longdrinks</div>
      <div class="tab" data-cat="shots">Shots</div>
      <div class="tab" data-cat="snacks">Snacks</div>
      <div class="tab" data-cat="shisha">Shisha</div>
    </div>

    <div class="tabs" id="cocktailFilter" style="display:none; padding-top:0;">
      <div class="tab" data-alc="true">Alkoholisch</div>
      <div class="tab" data-alc="false">Alkoholfrei</div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="section-title" id="sectionTitle">Start</div>
  <div class="grid" id="grid"></div>
</main>

<footer class="wrap">
  <div class="hint">
    Alle Preise inkl. MwSt. â€¢ Ã„nderungen vorbehalten<br>
    Koffeinhaltige GetrÃ¤nke: FÃ¼r Kinder und schwangere Frauen nicht empfohlen<br>
    Zusatzstoffe und Allergene auf Anfrage (z. B. NÃ¼sse)<br>
    Shisha-Genuss nur ab 18 Jahren
  </div>
</footer>

<!-- Shisha Modal -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Shisha Sorten">
  <div class="sheet">
    <div class="sheetTop">
      <div>
        <h3 id="modalTitle">Shisha Sorten</h3>
        <p id="modalSub"></p>
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button class="close" id="modalAddToCart" type="button">In den Warenkorb</button>
        <button class="close" id="modalClose" type="button">Schliessen</button>
      </div>
    </div>
    <div class="list" id="modalList"></div>
  </div>
</div>

<!-- Warenkorb Modal -->
<div class="modal" id="cartModal" role="dialog" aria-modal="true" aria-label="Warenkorb">
  <div class="sheet">
    <div class="sheetTop">
      <div>
        <h3>Warenkorb</h3>
        <p>AusgewÃ¤hlte Artikel</p>
      </div>
      <button class="close" id="cartClose" type="button">Schliessen</button>
    </div>

    <div class="list" id="cartList" style="grid-template-columns:1fr; gap:10px;"></div>

    <div class="totalRow">
      <div>Summe</div>
      <div id="cartTotal">0,00 â‚¬</div>
    </div>

    <div class="cartActions">
      <button class="btn" id="cartCopy" type="button">Bestellung kopieren</button>
      <button class="btn" id="cartClear" type="button" style="border-color:rgba(201,162,77,.35)">Leeren</button>
    </div>

    <p style="margin-top:10px;color:var(--muted);font-size:12px;line-height:1.4">
      Hinweis: Der Warenkorb dient nur zur Auswahl/Anzeige und ist keine Online-Bestellung.
    </p>
  </div>
</div>

<script>
  const shishaTraditionell = ["Traube Minze","Zitrone Minze","Doppelapfel","Falim","Falim Red","Black Nana"];
  const shishaFruchtig = ["Kiwi","African Queen","Ice Kaktus","Love 66","Blaubeere","Wildberry Chill","Lemon Chill","Drachenfrucht","Ananas","Ice Bonbon",];

  const items = [
    {cat:"shisha", name:"Shisha â€“ Traditionell", price:"12,00 â‚¬", desc:"Sorten anzeigen", img:"images/shishatraditionell.jpg",
      action:{type:"modal", title:"Shisha â€“ Traditionell (12,00 â‚¬)", sub:"Sorten", list: shishaTraditionell}},
    {cat:"shisha", name:"Shisha â€“ Fruchtig", price:"14,00 â‚¬", desc:"Sorten anzeigen", img:"images/shishafruchtig.jpg",
      action:{type:"modal", title:"Shisha â€“ Fruchtig (14,00 â‚¬)", sub:"Sorten", list: shishaFruchtig}},
    {cat:"shisha", name:"Kopfwechsel", price:"9,00 â‚¬", desc:"Neuer Kopf", img:"images/shishkopfwechsel.jpg"},

    {cat:"cocktail", alc:true,  name:"Sex on the Beach", price:"8,90 â‚¬", img:"images/sexonthebeach.jpg"},
    {cat:"cocktail", alc:true,  name:"Mai Tai", price:"8,90 â‚¬", img:"images/maitai.jpg"},
    {cat:"cocktail", alc:true,  name:"Mojito", price:"8,90 â‚¬", img:"images/mojito.jpg"},
    {cat:"cocktail", alc:true,  name:"Long Island Iced Tea", price:"8,90 â‚¬", img:"images/longislandicedtea.jpg"},
    {cat:"cocktail", alc:true,  name:"PiÃ±a Colada", price:"8,90 â‚¬", img:"images/pinacolada.jpg"},
    {cat:"cocktail", alc:true,  name:"Tequila Sunrise", price:"8,90 â‚¬", img:"images/tequilasunrise.jpg"},
    {cat:"cocktail", alc:true,  name:"Strawberry Margarita", price:"8,90 â‚¬", img:"images/strawberrymargarita.jpg"},
    {cat:"cocktail", alc:true,  name:"Blue Lagoon", price:"8,90 â‚¬", img:"images/bluelagoon.jpg"},

    {cat:"cocktail", alc:false, name:"Virgin Mojito", price:"6,90 â‚¬", img:"images/mojito.jpg"},
    {cat:"cocktail", alc:false, name:"Ipanema", price:"6,90 â‚¬", img:"images/ipanema.jpg"},
    {cat:"cocktail", alc:false, name:"Virgin PiÃ±a Colada", price:"6,90 â‚¬", img:"images/pinacolada.jpg"},
    {cat:"cocktail", alc:false, name:"Virgin Tequila Sunrise", price:"6,90 â‚¬", img:"images/tequilasunrise.jpg"},

    {cat:"longdrink", name:"Jack Daniels (4 cl)", price:"6,90 â‚¬", img:"images/jackdaniels.jpg"},
    {cat:"longdrink", name:"Wildberry Lillet", price:"6,90 â‚¬", img:"images/wildberrylillet.jpg"},
    {cat:"longdrink", name:"Vodka Red Bull", price:"6,90 â‚¬", img:"images/vodkaredbull.jpg"},
    {cat:"longdrink", name:"Aperol Spritz", price:"6,90 â‚¬", img:"images/aperolspritz.jpg"},
    {cat:"longdrink", name:"Gin Tonic", price:"6,90 â‚¬", img:"images/gintonic.jpg"},
    {cat:"longdrink", name:"JÃ¤germeister Cola", price:"v", img:"images/jaegermeistercola.jpg"},
    {cat:"longdrink", name:"Bacardi Cola", price:"6,90 â‚¬", img:"images/bacardicola.jpg"},
    {cat:"longdrink", name:"Havanna Cola", price:"6,90 â‚¬", img:"images/havannacola.jpg"},

    {cat:"soft", name:"Cola (0,33 L)", price:"3,90 â‚¬", img:"images/cola.jpg"},
    {cat:"soft", name:"Fanta (0,33 L)", price:"3,90 â‚¬", img:"images/fanta.jpg"},
    {cat:"soft", name:"Sprite (0,33 L)", price:"3,90 â‚¬â‚¬", img:"images/sprite.jpg"},
    {cat:"soft", name:"Mezzo Mix (0,33 L)", price:"3,90 â‚¬", img:"images/mezzomix.jpg"},
    {cat:"soft", name:"Iced Tea (versch. Sorten)", price:"4,20 â‚¬", img:"images/icetea.jpg"},
    {cat:"soft", name:"Wasser still/sprudel", price:"3,50 â‚¬", img:"images/wasser.jpg"},
    {cat:"soft", name:"Red Bull (versch. Sorten)", price:"4,50 â‚¬", img:"images/redbull.jpg"},
    {cat:"soft", name:"Moloko Classic/Blaubeere", price:"4,50 â‚¬", img:"images/moloko.jpg"},
    {cat:"soft", name:"SÃ¤fte (0.33 versch. Sorten)", price:"4,50 â‚¬", img:"images/saefte.jpg"},

    {cat:"hot", name:"Tee (versch. Sorten)", price:"2,50 â‚¬", img:"images/tee.jpg"},
    {cat:"hot", name:"Cappuccino", price:"4,20 â‚¬", img:"images/capocciono.jpg"},
    {cat:"hot", name:"Espresso", price:"2,90 â‚¬", img:"images/espresso.jpg"},

    {cat:"shots", name:"Tequila (4 cl)", price:"2,90 â‚¬", img:"images/tequila.jpg"},
    {cat:"shots", name:"Jack Daniel`s (4 cl)", price:"2,90 â‚¬", img:"images/jackshot.jpg"},
    {cat:"shots", name:"JÃ¤germeister (4 cl)", price:"2,90 â‚¬", img:"images/jaegermeister.jpg"},
    {cat:"shots", name:"Melonen Schnaps (4 cl)", price:"2,90 â‚¬", img:"images/melonenschnaps.jpg"},
    {cat:"shots", name:"Vodka (4 cl)", price:"2,90 â‚¬", img:"images/wodkashot.jpg"},
    
    {cat:"snacks", name:"NÃ¼sse", price:"3,50 â‚¬", desc:"(kann Allergene enthalten)", img:"images/erdnusse.jpg"},
    {cat:"snacks", name:"Niknaks", price:"3,50 â‚¬", desc:"(scharf)", img:"images/niknaks.jpg"},
    {cat:"snacks", name:"Chips (Paprika / Salz)", price:"3,50 â‚¬", img:"images/chips.jpg"},


  ];

  const categoriesHome = [
    {cat:"shisha",    title:"Shisha",     sub:"Traditionell & fruchtig", img:"images/lj_tile_shisha.jpg"},
    {cat:"cocktail",  title:"Cocktails",  sub:"Alkoholisch & alkoholfrei", img:"images/lj_tile_cocktails.jpg"},
    {cat:"longdrink", title:"Longdrinks", sub:"Klassiker", img:"images/lj_tile_longdrinks.jpg"},
    {cat:"soft",      title:"Softdrinks", sub:"Cola, Iced Tea, Wasser", img:"images/lj_tile_softdrinks.jpg"},
    {cat:"snacks",    title:"Snacks",     sub:"NÃ¼sse, Chips & mehr", img:"images/lj_tile_snacks.jpg"},
    {cat:"hot",       title:"Heiss",      sub:"Tee & Kaffee", img:"images/lj_tile_heiss.jpg"}
  ];

  const grid = document.getElementById("grid");
  const q = document.getElementById("q");
  const tabs = document.getElementById("tabs");
  const sectionTitle = document.getElementById("sectionTitle");
  const cocktailFilter = document.getElementById("cocktailFilter");
  const controls = document.getElementById("controls");

  /* Shisha Modal Elemente */
  const modal = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const modalSub = document.getElementById("modalSub");
  const modalList = document.getElementById("modalList");
  const modalAddToCart = document.getElementById("modalAddToCart");
  const modalClose = document.getElementById("modalClose"); // âœ… FIX: war bei dir nicht definiert

  let modalItemRef = null; // âœ… FIX: Referenz auf aktuelles Shisha-Item

  /* Warenkorb Elemente */
  const cartBtn = document.getElementById("cartBtn");
  const cartCountEl = document.getElementById("cartCount");
  const cartModal = document.getElementById("cartModal");
  const cartClose = document.getElementById("cartClose");
  const cartList = document.getElementById("cartList");
  const cartTotalEl = document.getElementById("cartTotal");
  const cartCopy = document.getElementById("cartCopy");
  const cartClear = document.getElementById("cartClear");

  let activeCat = "home";
  let activeAlc = "all";

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  /* ===========================
     Shisha Modal â€“ FIXED
  ============================ */
  function openModal(title, sub, list, itemRef){
    modalTitle.textContent = title || "Details";
    modalSub.textContent = sub || "";
    modalList.innerHTML = (list || []).map(x => `<div class="li">${escapeHtml(x)}</div>`).join("");
    modalItemRef = itemRef || null;
    modalAddToCart.style.display = modalItemRef ? "inline-flex" : "none";
    modal.classList.add("open");
  }
  function closeModal(){
    modal.classList.remove("open");
    modalItemRef = null;
  }
  modalClose.addEventListener("click", closeModal);
  modal.addEventListener("click", (e) => { if(e.target === modal) closeModal(); });

  modalAddToCart.addEventListener("click", () => {
    if(!modalItemRef) return;
    addToCart(modalItemRef);
    modalAddToCart.textContent = "HinzugefÃ¼gt";
    setTimeout(()=> modalAddToCart.textContent = "In den Warenkorb", 900);
  });

  /* ===========================
     Cocktail-Filter UI
  ============================ */
  function resetCocktailFilterUI(){
    activeAlc = "all";
    [...cocktailFilter.querySelectorAll(".tab")].forEach(t =>
      t.classList.toggle("active", t.dataset.alc === "all")
    );
  }

  /* ===========================
     Warenkorb Logik
  ============================ */
  const CART_KEY = "lj_cart_v1";
  let cart = loadCart(); // { "<name>": {qty, priceText, cat} }

  function loadCart(){
    try{
      const raw = localStorage.getItem(CART_KEY);
      return raw ? JSON.parse(raw) : {};
    }catch{ return {}; }
  }
  function saveCart(){
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
    updateCartBadge();
  }
  function parseEuro(s){
    const n = String(s || "").replace("â‚¬","").trim().replace(".","").replace(",",".");
    const v = Number(n);
    return Number.isFinite(v) ? v : 0;
  }
  function formatEuro(v){
    return v.toFixed(2).replace(".", ",") + " â‚¬";
  }
  function updateCartBadge(){
    const count = Object.values(cart).reduce((a,x)=>a + (x.qty||0), 0);
    cartCountEl.textContent = String(count);
  }
  function addToCart(item){
    const key = item.name;
    cart[key] = cart[key] || { qty:0, priceText:item.price, cat:item.cat };
    cart[key].qty += 1;
    saveCart();
  }
  function removeFromCart(item){
    const key = item.name;
    if(!cart[key]) return;
    cart[key].qty -= 1;
    if(cart[key].qty <= 0) delete cart[key];
    saveCart();
  }
  function openCart(){
    renderCart();
    cartModal.classList.add("open");
  }
  function closeCart(){
    cartModal.classList.remove("open");
  }
  function renderCart(){
    const entries = Object.entries(cart);
    if(entries.length === 0){
      cartList.innerHTML = `<div style="color:#b6b6b6;padding:8px">Warenkorb ist leer.</div>`;
      cartTotalEl.textContent = "0,00 â‚¬";
      return;
    }

    let total = 0;
    cartList.innerHTML = entries.map(([name, it]) => {
      const price = parseEuro(it.priceText);
      total += price * it.qty;
      return `
        <div class="cartLine">
          <div class="cartLeft">
            <div class="cartName">${escapeHtml(name)}</div>
            <div class="cartMeta">${escapeHtml(it.priceText)} â€¢ ${escapeHtml(it.cat)}</div>
          </div>
          <div class="cartRight">
            <div class="qtyRow">
              <button class="qtyBtn" data-cart="minus" data-name="${escapeHtml(name)}">âˆ’</button>
              <div style="min-width:22px;text-align:center;font-weight:900">${it.qty}</div>
              <button class="qtyBtn" data-cart="plus" data-name="${escapeHtml(name)}">+</button>
            </div>
            <div style="color:var(--accent);font-weight:900">${formatEuro(price * it.qty)}</div>
          </div>
        </div>
      `;
    }).join("");

    cartTotalEl.textContent = formatEuro(total);
  }

  cartBtn.addEventListener("click", openCart);
  cartClose.addEventListener("click", closeCart);
  cartModal.addEventListener("click", (e) => { if(e.target === cartModal) closeCart(); });

  cartList.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-cart]");
    if(!btn) return;
    const name = btn.dataset.name;
    const item = items.find(x => x.name === name);
    if(!item) return;
    if(btn.dataset.cart === "plus") addToCart(item);
    if(btn.dataset.cart === "minus") removeFromCart(item);
    renderCart();
  });

  cartClear.addEventListener("click", () => {
    cart = {};
    saveCart();
    renderCart();
  });

  cartCopy.addEventListener("click", async () => {
    const lines = Object.entries(cart).map(([n, it]) => `${it.qty}x ${n} (${it.priceText})`);
    const total = cartTotalEl.textContent;
    const text = `Bestellung LJ Lounge:\n${lines.join("\n")}\n\nSumme: ${total}`;
    try{
      await navigator.clipboard.writeText(text);
      cartCopy.textContent = "Kopiert";
      setTimeout(()=> cartCopy.textContent="Bestellung kopieren", 1200);
    }catch{
      alert("Kopieren nicht mÃ¶glich. Bitte manuell markieren.");
    }
  });

  updateCartBadge();

  /* ===========================
     Render
  ============================ */
  function renderHome(){
    sectionTitle.textContent = "Start";
    grid.innerHTML = categoriesHome.map(c => `
      <div class="tile" data-goto="${escapeHtml(c.cat)}" role="button" aria-label="${escapeHtml(c.title)}">
        <img src="${escapeHtml(c.img)}" alt="${escapeHtml(c.title)}" loading="lazy">
        <div class="tileText">
          <div class="tileTitle">${escapeHtml(c.title)}</div>
          <div class="tileSub">${escapeHtml(c.sub)}</div>
        </div>
      </div>
    `).join("");
  }

  function renderList(){
    const query = (q.value || "").trim().toLowerCase();

    const filtered = items.filter(x => {
      if(x.cat !== activeCat) return false;

      if(activeCat === "cocktail" && activeAlc !== "all"){
        if(String(!!x.alc) !== activeAlc) return false;
      }

      if(query){
        const hay = (x.name + " " + (x.desc||"")).toLowerCase();
        if(!hay.includes(query)) return false;
      }
      return true;
    });

    sectionTitle.textContent =
      [...tabs.querySelectorAll(".tab")].find(t=>t.dataset.cat===activeCat)?.textContent || "Menu";

    grid.innerHTML = filtered.map((x) => {
      const hasAction = x.action && x.action.type === "modal";

      return `
        <article class="card" data-name="${escapeHtml(x.name)}">
          <img class="img" src="${escapeHtml(x.img)}" alt="${escapeHtml(x.name)}" loading="lazy">
          <div class="pad">
            <div class="row">
              <div class="name">${escapeHtml(x.name)}</div>
              <div class="price">${escapeHtml(x.price)}</div>
            </div>
            ${x.desc ? `<div class="desc">${escapeHtml(x.desc)}</div>` : ``}
          </div>

          <div class="actions">
            ${
              hasAction
                ? `<button class="btn" data-action="open" type="button">Sorten anzeigen</button>`
                : `
                  <div class="btnRow">
                    <button class="btn" data-cartadd="1" type="button">+ HinzufÃ¼gen</button>
                    <button class="btn icon" data-cartremove="1" aria-label="Entfernen" type="button">âˆ’</button>
                  </div>
                `
            }
          </div>
        </article>
      `;
    }).join("");

    if(filtered.length === 0){
      grid.innerHTML = `<div style="color:#b6b6b6;padding:10px">Keine Treffer.</div>`;
    }
  }

  function render(){
    const isHome = activeCat === "home";
    controls.style.display = isHome ? "none" : "flex";
    cocktailFilter.style.display = (!isHome && activeCat === "cocktail") ? "flex" : "none";

    if(isHome){ renderHome(); return; }
    renderList();
  }

  function setActive(cat){
    activeCat = cat;

    [...tabs.querySelectorAll(".tab")].forEach(t =>
      t.classList.toggle("active", t.dataset.cat === cat)
    );

    if(cat === "cocktail"){ resetCocktailFilterUI(); }
    render();
  }

  tabs.addEventListener("click", (e) => {
    const t = e.target.closest(".tab");
    if(!t) return;
    setActive(t.dataset.cat);
  });

  cocktailFilter.addEventListener("click", (e) => {
    const t = e.target.closest(".tab");
    if(!t) return;
    activeAlc = t.dataset.alc;
    [...cocktailFilter.querySelectorAll(".tab")].forEach(x =>
      x.classList.toggle("active", x === t)
    );
    render();
  });

  grid.addEventListener("click", (e) => {
    const tile = e.target.closest(".tile");
    if(tile){ setActive(tile.dataset.goto); return; }

    const btn = e.target.closest("button[data-action='open']");
    if(btn){
      const card = e.target.closest(".card");
      const name = card?.dataset?.name;
      const x = items.find(it => it.name === name);
      if(x?.action?.type === "modal"){
        openModal(x.action.title, x.action.sub, x.action.list, x);
      }
      return;
    }

    const add = e.target.closest("button[data-cartadd]");
    const rem = e.target.closest("button[data-cartremove]");
    if(add || rem){
      const card = e.target.closest(".card");
      const name = card?.dataset?.name;
      const item = items.find(it => it.name === name);
      if(!item) return;
      if(add) addToCart(item);
      if(rem) removeFromCart(item);
      return;
    }
  });

  /* ESC schliesst beide Modals */
  document.addEventListener("keydown", (e) => {
    if(e.key !== "Escape") return;
    closeModal();
    closeCart();
  });

  q.addEventListener("input", render);
  render();
</script>

</body>
</html>
